doctype html
html
	head

		script(src="https://cdn.socket.io/socket.io-1.4.5.js")
		script(src="https://ajax.googleapis.com/ajax/libs/jquery/3.0.0/jquery.min.js")
		link(rel="stylesheet",
		     href="css/report.css")

		script.
			var lec = !{JSON.stringify(lectures)};
			var allLec = !{JSON.stringify(alldata)};
			var table_content = '<tr><th>Tag Name</th><th>Overall Yes% (Student/Average)</th><th>Overall No% (Student / Average)</th><th>Overall Unknown% (Student / Average)</th><th>Yes% that gave an answer (Student / Average)</th><th>No% that gave an answer (Student / Average)</th></tr>';

			
			var overallColspan = 6;
			
			$(document).ready(function(){
				function invokePostCall(action, postName, value)
				{
					var form = $('<form style="display: none" action="'+action+'", method="post"><input id="postVar" name="'+postName+'"/><button id="go"></button></form>');
					form.find('#postVar').val(value);
					form.find('#go').trigger("click");
				}

				$('#lecture_table').append(table_content);

				addToTable('lecture_table', lec, allLec);
				
				$('.lecture').click(function(event){
					invokePostCall('/lectureReport', 'lecture', $(event.target).text());
				});
			});

			function createScoreData(item)
			{
			    return {
			        overallYes: percentFormat(item.U, item.length),
			        overallNo: percentFormat(item.D, item.length),
			        overallUnknown: percentFormat(item.UNK, item.length),
			        givenYes: percentFormat(item.U, item.U+item.D),
			        givenNo: percentFormat(item.D, item.U+item.D)
			    };
			}

			function addToTable(tableid, stats, allstats)
			{
				Object.keys(stats).forEach(function(lecture){//each leacture/student
					var lecVar = stats[lecture];
					var allLecVar = allstats[lecture];

					$('#' + tableid).append(makeHeadTableInsert(lecture, overallColspan));

					Object.keys(lecVar).forEach(function(section){//each section
						var secVar = lecVar[section];
						var allSecVar = allLecVar[section];

						$('#' + tableid).append(makeNameTableInsert(section, overallColspan));
						Object.keys(secVar).forEach(function(tag){//each tag
							$('#' + tableid).append(makeTableInsert(tag, secVar[tag], allSecVar[tag]));
						});
					});
				});
			}

			function makeHeadTableInsert(value, colspan)
			{
				return '<tr class="removable"><th class="lecture" colspan='+colspan+'>'+ value+'</td></tr>';	
			}

			function makeNameTableInsert(title, colspan)
			{
				return '<tr class="removable "><td class="title" colspan='+colspan+'>'+ title + '</td></tr>';	
			}

			function tableEntry(tag1, tag2)
			{
				return '<td>'+ tag1 + ' / ' + tag2 +'</td>'
			}

			function makeTableInsert(tag, item, allstats_item)
			{
				var calScore = createScoreData(item);
				var calAllScore = createScoreData(allstats_item);
				return '<tr class="removable">'+
				'<td>'+tag+'</td>' +
				tableEntry(calScore.overallYes, calAllScore.overallYes) + 
				tableEntry(calScore.overallNo, calAllScore.overallNo) +
				tableEntry(calScore.overallUnknown, calAllScore.overallUnknown) +
				tableEntry(calScore.givenYes, calAllScore.givenYes) +
				tableEntry(calScore.givenNo, calAllScore.givenNo) +'</tr>';	
			}

			function percentFormat(score, length)
			{
				return ((score/length) * 100).toFixed(2) + "%";
			}
			
	body
		div
			table(id="lecture_table", border="1")

